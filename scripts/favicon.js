/*
 * Material You NewTab
 * Copyright (c) 2023-2025 XengShi
 * Licensed under the GNU General Public License v3.0 (GPL-3.0)
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

// Function to update the favicon
const updateFavicon = (hexColor) => {
    const faviconLink = document.querySelector("link[rel='icon']");

    // Check if cached version exists
    const cachedFavicon = localStorage.getItem(`favicon_${hexColor}`);
    if (cachedFavicon) {
        faviconLink.href = cachedFavicon;
        return;
    }

    // Fetch colors from CSS variables
    const rootStyles = getComputedStyle(document.documentElement);
    const darkColor = rootStyles.getPropertyValue("--darkColor-blue");
    const bgColor = rootStyles.getPropertyValue("--bg-color-blue");

    // Construct the SVG string with dynamic colors
    const svgTemplate = `
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 1650 1650">
        <path
            d="M0 0 C0.76 0 1.52 0 2.31 0 C21.29 0.05 39.19 2.89 57.06 9.38 C58.29 9.82 59.51 10.26 60.78 10.71 C84.19 19.61 104.56 33.45 122 51.38 C145.96 75.90 177.78 90.68 211.06 97.38 C212.25 97.62 213.44 97.87 214.67 98.13 C239.83 102.38 265.50 99.19 290.03 93.18 C302.45 90.17 314.67 88.98 327.44 89.0 C328.47 89.0 328.47 89.0 329.53 89.0 C366.3 89.13 401.59 101.46 431.06 123.38 C431.94 124.03 432.82 124.68 433.72 125.35 C464.66 149.53 483.7 181.33 494.38 218.75 C502.17 245.82 517.0 268.93 536.06 289.38 C536.76 290.13 537.46 290.88 538.18 291.65 C558.42 312.71 585.49 325.89 613.06 334.38 C626.01 338.41 638.2 342.77 650.06 349.38 C650.68 349.71 651.3 350.05 651.94 350.4 C691.19 371.9 719.12 410.0 732.06 452.38 C740.63 484.52 739.75 516.19 731.86 548.34 C728.88 560.69 727.7 572.81 727.75 585.5 C727.75 586.17 727.75 586.85 727.76 587.54 C727.81 599.05 728.61 610.12 731.06 621.38 C731.23 622.16 731.4 622.94 731.57 623.74 C738.56 655.59 755.39 685.56 778.94 708.13 C809.38 738.08 825.02 781.32 825.49 823.47 C825.73 870.05 808.54 911.4 777.06 945.38 C775.51 946.93 773.95 948.47 772.38 950.0 C742.41 979.42 727.66 1023.63 726.81 1064.88 C727.16 1081.93 730.16 1098.33 734.14 1114.86 C737.58 1129.34 739.96 1144.45 739.06 1159.38 C739.02 1160.08 738.98 1160.79 738.94 1161.51 C736.56 1199.12 723.25 1235.94 698.06 1264.38 C697.4 1265.13 697.4 1265.13 696.73 1265.91 C685.08 1279.25 672.08 1290.02 657.06 1299.38 C655.99 1300.06 654.92 1300.75 653.81 1301.46 C639.77 1310.01 624.09 1315.31 608.38 1319.88 C586.18 1326.37 565.39 1336.93 548.06 1352.38 C547.21 1353.11 546.37 1353.85 545.49 1354.62 C542.98 1356.84 540.52 1359.09 538.06 1361.38 C537.35 1362.02 536.63 1362.67 535.89 1363.34 C512.54 1385.47 500.09 1414.64 491.06 1444.86 C477.78 1488.6 446.56 1523.77 406.72 1545.51 C366.94 1566.25 323.84 1567.96 281.06 1557.38 C236.15 1546.36 190.77 1554.23 151.06 1577.38 C146.55 1580.13 142.27 1583.16 138.06 1586.38 C137.12 1587.09 136.19 1587.81 135.22 1588.55 C130.36 1592.39 125.9 1596.46 121.56 1600.88 C97.9 1624.94 68.63 1639.51 36.06 1647.38 C35.32 1647.55 34.58 1647.73 33.82 1647.92 C-7.13 1657.3 -52.7 1647.76 -88.44 1626.63 C-101.05 1618.69 -112.06 1608.98 -122.75 1598.66 C-147.72 1575.01 -180.7 1558.74 -214.94 1554.38 C-215.57 1554.29 -216.21 1554.2 -216.86 1554.1 C-242.49 1550.78 -267.27 1554.7 -292.21 1560.31 C-335.26 1569.92 -381.11 1560.21 -418.25 1536.93 C-427.95 1530.57 -436.65 1523.48 -444.94 1515.38 C-445.93 1514.44 -446.92 1513.51 -447.92 1512.58 C-470.53 1491.12 -483.79 1463.65 -492.25 1434.0 C-500.05 1406.93 -514.87 1383.82 -533.94 1363.38 C-534.98 1362.25 -534.98 1362.25 -536.05 1361.1 C-555.49 1340.88 -582.33 1326.44 -609.18 1318.87 C-628.59 1313.38 -647.77 1305.69 -663.94 1293.38 C-664.0 1292.6 -666.06 1291.83 -667.16 1291.04 C-687.81 1275.73 -703.22 1256.52 -715.94 1234.38 C-716.91 1232.68 -716.91 1232.68 -717.91 1230.96 C-737.07 1195.19 -740.41 1152.53 -731.94 1113.38 C-731.72 1112.35 -731.5 1111.32 -731.27 1110.27 C-730.4 1106.21 -729.53 1102.16 -728.6 1098.12 C-719.02 1056.23 -729.42 1011.3 -751.58 975.17 C-759.43 962.9 -769.22 951.67 -779.81 941.69 C-808.37 913.36 -824.87 871.06 -825.18 831.19 C-825.26 802.88 -825.26 802.88 -821.94 789.38 C-821.73 788.53 -821.53 787.69 -821.32 786.83 C-818.32 774.81 -814.38 763.49 -808.94 752.38 C-808.61 751.69 -808.28 751.0 -807.94 750.3 C-800.5 734.91 -790.63 721.81 -778.94 709.38 C-776.6 706.84 -774.28 704.3 -771.96 701.76 C-769.92 699.54 -767.89 697.32 -765.81 695.14 C-736.41 663.61 -724.51 618.64 -725.79 576.49 C-726.48 561.91 -729.55 547.74 -732.87 533.56 C-733.12 532.48 -733.37 531.4 -733.63 530.29 C-733.97 528.87 -733.97 528.87 -734.32 527.41 C-742.78 485.75 -731.57 439.86 -708.42 404.87 C-703.98 398.4 -699.05 392.31 -693.94 386.38 C-693.09 385.4 -692.25 384.42 -691.38 383.41 C-680.76 371.34 -668.57 361.83 -654.94 353.38 C-654.32 352.99 -653.69 352.6 -653.05 352.2 C-639.47 343.8 -624.86 338.3 -609.54 333.94 C-599.83 331.17 -590.79 327.75 -581.69 323.38 C-580.68 322.89 -579.67 322.4 -578.62 321.9 C-539.27 302.39 -508.6 267.08 -494.28 225.58 C-492.93 221.44 -491.72 217.26 -490.5 213.09 C-477.1 167.5 -448.0 132.08 -406.74 108.74 C-382.13 95.34 -355.0 89.15 -327.13 89.13 C-326.34 89.12 -325.55 89.12 -324.75 89.12 C-307.94 89.15 -292.84 91.62 -276.55 95.6 C-233.13 106.07 -188.04 96.73 -149.94 74.38 C-139.67 68.0 -130.89 60.07 -122.22 51.72 C-88.39 19.19 -47.47 -0.12 0 0 Z"
            fill="${bgColor}" transform="translate(825,0)" />
        <path
            d="M0 0 C0.8 0 1.61 0 2.44 0 C15.43 0.05 28.04 0.8 40.81 3.31 C41.57 3.46 42.34 3.6 43.12 3.75 C48.4 4.77 53.61 6.0 58.81 7.31 C59.63 7.52 60.45 7.72 61.29 7.93 C79.41 12.54 95.87 19.74 112.5 28.19 C163.66 54.11 223.63 70.26 280.81 56.31 C281.87 56.06 282.93 55.81 284.01 55.55 C311.82 48.8 338.01 38.02 363.44 25 C396.08 8.34 431.39 -0.17 468 0 C468.8 0 469.61 0 470.44 0 C483.43 0.05 496.04 0.8 508.81 3.31 C509.57 3.46 510.34 3.6 511.12 3.75 C516.4 4.77 521.61 6.0 526.81 7.31 C527.63 7.52 528.45 7.72 529.29 7.93 C556.3 14.8 582.23 26.95 604.81 43.31 C605.37 43.72 605.93 44.12 606.51 44.54 C613.81 49.87 620.57 55.66 627.16 61.85 C629.27 63.81 631.4 65.67 633.63 67.5 C637.45 70.75 640.58 74.48 643.81 78.31 C644.63 79.24 645.44 80.16 646.28 81.12 C675.29 114.3 693.6 154.93 700.81 198.31 C701.04 199.59 701.26 200.86 701.5 202.18 C708.38 248.64 699.13 298.63 677.89 340.19 C674.66 346.54 671.67 353.01 668.67 359.47 C667.95 361.02 667.22 362.55 666.48 364.09 C645.07 409.42 634.41 464.92 646.81 514.31 C647.09 515.41 647.36 516.5 647.64 517.63 C655.1 546.67 666.33 574.01 680.06 600.63 C690.61 621.21 696.88 643.61 700.81 666.31 C701.04 667.6 701.27 668.88 701.5 670.2 C708.58 718.36 698.41 769.58 675.81 812.31 C675.46 813.0 675.1 813.66 674.74 814.35 C665.84 831.06 654.74 845.96 642 859.93 C640.02 862.09 638.13 864.28 636.25 866.5 C632.74 870.51 628.88 873.89 624.81 877.31 C623.88 878.14 622.94 878.96 621.98 879.81 C591.0 906.93 551.34 926.0 510.81 933.31 C509.77 933.51 508.73 933.7 507.66 933.9 C461.82 941.72 410.43 935.55 368.81 914.31 C365.27 912.52 361.73 910.72 358.19 908.94 C357.24 908.46 356.3 907.99 355.33 907.49 C346.33 903.0 337.15 899.06 327.81 895.31 C326.72 894.87 325.64 894.42 324.52 893.96 C308.8 887.67 292.42 882.61 275.81 879.31 C275.12 879.16 274.43 879.01 273.72 878.86 C260.45 876.06 247.07 876.0 233.56 875.94 C232.67 875.93 231.77 875.92 230.85 875.91 C218.81 875.83 207.58 876.84 195.81 879.31 C193.9 879.67 191.98 880.03 190.07 880.38 C162.11 885.98 136.0 896.54 110.61 909.4 C97.52 916.02 84.41 921.67 70.44 926.19 C69.3 926.56 68.16 926.93 66.98 927.31 C14.14 943.88 -49.67 939.84 -99.19 914.31 C-100.34 913.73 -100.34 913.73 -101.52 913.15 C-113.27 907.26 -124.54 901.03 -135.19 893.31 C-135.75 892.91 -136.31 892.5 -136.89 892.08 C-144.19 886.75 -150.95 880.96 -157.54 874.78 C-159.64 872.82 -161.78 870.95 -164 869.13 C-167.82 865.88 -170.96 862.14 -174.19 858.31 C-175.43 856.91 -175.43 856.91 -176.69 855.47 C-203.8 824.49 -222.87 784.84 -230.19 744.31 C-230.38 743.27 -230.57 742.23 -230.77 741.16 C-238.59 695.32 -232.42 643.93 -211.19 602.31 C-209.39 598.77 -207.6 595.23 -205.81 591.69 C-205.1 590.27 -205.1 590.27 -204.37 588.83 C-199.87 579.83 -195.93 570.65 -192.19 561.31 C-191.74 560.22 -191.29 559.14 -190.83 558.02 C-184.76 542.84 -179.75 527.03 -176.7 511.0 C-176.3 508.89 -175.87 506.83 -175.43 504.78 C-173.15 493.74 -172.72 482.99 -172.8 471.74 C-172.81 468.82 -172.8 465.89 -172.78 462.97 C-172.76 451.41 -173.77 440.61 -176.19 429.31 C-176.55 427.4 -176.9 425.48 -177.26 423.57 C-182.86 395.61 -193.41 369.47 -206.27 344.11 C-212.9 331.02 -218.54 317.91 -223.06 303.94 C-223.43 302.8 -223.8 301.66 -224.18 300.48 C-240.76 247.64 -236.72 183.83 -211.19 134.31 C-210.61 133.16 -210.61 133.16 -210.02 131.98 C-204.13 120.23 -197.91 108.96 -190.19 98.31 C-189.78 97.75 -189.38 97.19 -188.96 96.61 C-183.63 89.31 -177.84 82.55 -171.65 75.96 C-169.69 73.86 -167.83 71.72 -166 69.5 C-162.75 65.68 -159.02 62.54 -155.19 59.31 C-154.26 58.5 -153.34 57.69 -152.38 56.85 C-110.32 20.07 -55.8 -0.26 0 0 Z"
            fill="#FFFFFF" transform="translate(589.19,355.69)" />
        <path
            d="M0 0 C6.57 4.85 12.4 10.77 18.33 16.38 C21.43 19.3 24.59 22.12 27.82 24.9 C30.53 27.28 33.19 29.72 35.84 32.17 C39.14 35.21 42.45 38.23 45.84 41.17 C49.77 44.57 53.59 48.1 57.42 51.62 C60.19 54.17 62.99 56.7 65.84 59.17 C69.77 62.57 73.59 66.1 77.42 69.62 C80.19 72.17 82.99 74.7 85.84 77.17 C89.77 80.57 93.59 84.1 97.42 87.62 C100.19 90.17 102.99 92.7 105.84 95.17 C109.77 98.57 113.59 102.1 117.42 105.62 C120.19 108.17 122.99 110.7 125.84 113.17 C129.77 116.57 133.59 120.1 137.42 123.62 C140.19 126.17 142.99 128.7 145.84 131.17 C149.77 134.57 153.59 138.1 157.42 141.62 C160.19 144.17 162.99 146.7 165.84 149.17 C169.77 152.57 173.59 156.1 177.42 159.62 C180.19 162.17 182.99 164.7 185.84 167.17 C189.23 170.11 192.54 173.13 195.84 176.17 C199.8 179.81 203.79 183.41 207.86 186.93 C211.89 190.46 215.86 194.07 219.84 197.67 C221.51 199.17 223.17 200.67 224.84 202.17 C254.84 229.17 254.84 229.17 257.31 231.4 C259.06 232.97 260.82 234.54 262.59 236.09 C263.92 237.28 263.92 237.28 265.28 238.48 C266.48 239.54 266.48 239.54 267.71 240.63 C271.68 244.44 273.67 247.38 274.09 253 C273.64 259.56 270.72 263.4 265.84 267.67 C262.66 268.73 260.42 268.79 257.08 268.78 C255.9 268.78 254.72 268.78 253.5 268.78 C252.23 268.78 250.95 268.77 249.64 268.77 C248.34 268.76 247.03 268.76 245.69 268.76 C242.22 268.76 238.75 268.75 235.28 268.74 C231.74 268.73 228.21 268.72 224.67 268.72 C217.72 268.71 210.78 268.69 203.84 268.67 C203.85 270.42 203.85 270.42 203.85 272.22 C203.94 300.04 204.0 327.86 204.04 355.68 C204.05 359.1 204.05 362.53 204.06 365.96 C204.06 366.98 204.06 366.98 204.06 368.03 C204.08 379.06 204.11 390.1 204.15 401.13 C204.19 412.46 204.21 423.79 204.22 435.12 C204.22 441.48 204.23 447.84 204.26 454.2 C204.29 460.19 204.3 466.18 204.29 472.17 C204.29 474.37 204.3 476.56 204.32 478.76 C204.34 481.76 204.33 484.77 204.32 487.77 C204.34 489.06 204.34 489.06 204.36 490.38 C204.26 500.17 200.6 507.74 193.92 514.76 C186.4 521.66 178.21 522.97 168.37 522.94 C167.33 522.95 166.29 522.95 165.22 522.96 C161.78 522.97 158.35 522.97 154.91 522.97 C152.52 522.97 150.12 522.98 147.73 522.98 C142.71 522.99 137.7 522.99 132.68 522.98 C126.27 522.98 119.85 522.99 113.43 523.02 C108.49 523.03 103.54 523.03 98.6 523.03 C96.24 523.03 93.87 523.04 91.5 523.05 C88.19 523.06 84.88 523.05 81.57 523.04 C80.6 523.05 79.62 523.06 78.62 523.06 C69.22 523.0 61.83 520.32 54.83 513.8 C45.12 503.75 44.25 492.88 44.39 479.46 C44.39 477.85 44.39 476.24 44.38 474.63 C44.38 470.3 44.41 466.97 44.43 461.64 C44.46 457.1 44.46 452.56 44.47 448.02 C44.48 439.44 44.51 430.86 44.55 422.28 C44.6 410.67 44.63 399.07 44.65 387.46 C44.69 369.2 44.77 350.93 44.84 332.67 C2.93 332.67 -38.98 332.67 -82.16 332.67 C-82.13 344.49 -82.09 356.3 -82.05 368.48 C-82.04 375.96 -82.02 383.45 -82.01 390.93 C-82 402.81 -81.97 414.69 -81.93 426.57 C-81.9 435.22 -81.88 443.87 -81.88 452.52 C-81.87 457.1 -81.86 461.68 -81.84 466.26 C-81.82 470.58 -81.82 474.89 -81.82 479.21 C-81.82 480.79 -81.81 482.37 -81.8 483.95 C-81.72 495.47 -82.42 504.81 -90.95 513.49 C-99.52 521.4 -107.68 522.82 -119.04 522.81 C-120.03 522.82 -121.02 522.82 -122.04 522.82 C-125.32 522.83 -128.59 522.83 -131.86 522.84 C-134.14 522.84 -136.42 522.84 -138.71 522.85 C-143.49 522.85 -148.27 522.85 -153.05 522.85 C-159.16 522.85 -165.28 522.87 -171.39 522.88 C-176.1 522.9 -180.81 522.9 -185.53 522.9 C-187.78 522.9 -190.03 522.9 -192.29 522.91 C-195.45 522.92 -198.6 522.92 -201.76 522.91 C-202.69 522.92 -203.61 522.92 -204.56 522.93 C-215.57 522.87 -223.73 520.64 -231.92 513.04 C-238.47 505.95 -240.77 498.35 -240.64 488.85 C-240.64 487.91 -240.65 487.0 -240.65 486.0 C-240.66 482.83 -240.64 479.68 -240.61 476.53 C-240.61 474.27 -240.61 472.0 -240.62 469.73 C-240.62 463.59 -240.59 457.45 -240.57 451.31 C-240.54 444.89 -240.54 438.47 -240.53 432.05 C-240.52 421.27 -240.5 410.5 -240.46 399.72 C-240.43 388.63 -240.4 377.53 -240.38 366.44 C-240.38 365.41 -240.38 365.41 -240.38 364.37 C-240.37 360.93 -240.37 357.5 -240.36 354.06 C-240.32 325.6 -240.25 297.13 -240.16 268.67 C-240.9 268.68 -241.64 268.69 -242.4 268.69 C-249.37 268.78 -256.34 268.84 -263.32 268.88 C-266.9 268.9 -270.49 268.92 -274.07 268.97 C-277.54 269.01 -281.0 269.04 -284.46 269.05 C-286.42 269.06 -288.38 269.09 -290.33 269.12 C-301.47 269.12 -301.47 269.12 -306.16 264.67 C-309.6 260.06 -310.85 256.56 -310.54 250.79 C-309.01 242.15 -298.77 235.11 -292.43 229.65 C-289.63 227.2 -286.89 224.69 -284.16 222.17 C-280.25 218.57 -276.3 215.02 -272.29 211.54 C-269.54 209.12 -266.85 206.65 -264.16 204.17 C-260.25 200.57 -256.3 197.02 -252.29 193.54 C-249.54 191.12 -246.85 188.65 -244.16 186.17 C-240.25 182.57 -236.3 179.02 -232.29 175.54 C-229.54 173.12 -226.85 170.65 -224.16 168.17 C-220.25 164.57 -216.3 161.02 -212.29 157.54 C-209.54 155.12 -206.85 152.65 -204.16 150.17 C-200.25 146.57 -196.3 143.02 -192.29 139.54 C-189.54 137.12 -186.85 134.65 -184.16 132.17 C-180.25 128.57 -176.3 125.02 -172.29 121.54 C-169.54 119.12 -166.85 116.65 -164.16 114.17 C-160.25 110.57 -156.3 107.02 -152.29 103.54 C-149.54 101.12 -146.85 98.65 -144.16 96.17 C-140.25 92.57 -136.3 89.02 -132.29 85.54 C-129.54 83.12 -126.85 80.65 -124.16 78.17 C-120.25 74.57 -116.3 71.02 -112.29 67.54 C-109.54 65.12 -106.85 62.65 -104.16 60.17 C-100.23 56.55 -96.26 52.98 -92.22 49.48 C-89.67 47.24 -87.17 44.95 -84.66 42.67 C-81.54 39.82 -78.41 37.0 -75.22 34.23 C-71.27 30.8 -67.43 27.26 -63.58 23.72 C-60.2 20.6 -56.77 17.55 -53.29 14.55 C-51.06 12.58 -48.9 10.55 -46.74 8.52 C-32.92 -4.41 -17.68 -10.9 0 0 Z"
            fill="${darkColor}" transform="translate(842.16,565.33)" />
        </svg>
   `;

    // Convert SVG to a Data URL
    const svgDataUrl = `data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(svgTemplate)))}`;

    // Set the new favicon
    faviconLink.href = svgDataUrl;

    // Remove previous cached favicons
    Object.keys(localStorage).forEach((key) => {
        if (key.startsWith("favicon_")) {
            localStorage.removeItem(key);
        }
    });

    // Store the new favicon
    localStorage.setItem(`favicon_${hexColor}`, svgDataUrl);
};